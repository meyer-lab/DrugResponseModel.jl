# replicate 1 parameters:
# ps = [59.132, 1.23216, 2.93162, 0.0224589, 0.275675, 2.99447, 0.493825, 0.582667, 0.0014566, 0.00738793, 0.0297349, 0.0763022, 0.00317598, 0.000262541, 172.905, 0.8691, 2.94725, 0.133166, 0.234383, 2.73361, 0.464481, 2.98659, 0.000172721, 0.000107943, 0.202668, 0.00391187, 0.000557085, 0.345508, 3.52234, 1.74014, 0.000323184, 0.255954, 0.100639, 0.124028, 0.730151, 0.901477, 0.0202751, 1.83514e-5, 1.5387e-5, 0.0315427, 0.000701986, 3.44425e-5, 2.37072, 2.10702, 0.542407, 0.0866461, 1.66253, 1.64308, 0.199229, 1.82007, 0.0594886, 0.0267128, 0.000201773, 0.000405221, 0.0151659, 0.00142696, 167.719, 0.684362, 2.18003, 0.0284909, 1.37066, 1.85981, 0.267127, 2.99785, 0.00214824, 3.36141e-5, 0.134529, 0.000727143, 6.67082e-5, 0.126732, 2.99503, 0.169147, 0.429907, 2.98509, 0.471941, 0.474202]
# p2 = [39.6429, 3.04648, 0.862182, 0.0576404, 2.99358, 2.99651, 0.215147, 2.26168, 2.39971e-5, 0.00384499, 2.30659e-5, 0.268735, 0.00468776, 3.73291e-5, 43.037, 0.578836, 1.2224, 0.0939547, 0.363637, 0.244978, 0.589517, 2.86951, 3.92075e-5, 0.00143901, 0.599199, 4.27321e-5, 4.40719e-5, 5.21621e-5, 4.16784, 1.85054, 0.50857, 0.233178, 0.00160662, 0.0790514, 2.99996, 2.99977, 9.80331e-7, 5.52581e-6, 0.0354535, 1.22166e-6, 6.87282e-6, 4.27447e-6, 5.76785, 2.63587, 0.167469, 1.2405, 2.99952, 0.155758, 2.99948, 0.468288, 4.18735e-6, 1.21706, 0.00143317, 1.0808e-5, 6.00208e-5, 1.91453e-5, 260.712, 9.02995, 0.0220563, 2.58494e-5, 2.99267, 0.311041, 0.0613426, 2.9715, 6.11616e-7, 1.22661e-6, 0.667531, 1.08597e-5, 7.78014e-7, 2.68103e-6, 0.215753, 1.15483, 2.99994, 0.279021, 1.74541, 0.695748]
# p3 = [57.7701, 0.95457, 0.0325867, 0.0412113, 0.429698, 0.967497, 0.849089, 2.9987, 0.0149979, 5.57127e-6, 4.39279e-5, 2.01576e-5, 3.30843e-5, 0.0629629, 88.7115, 1.01634, 2.73977, 0.0700161, 2.48209, 0.564991, 2.99984, 2.99375, 3.49147e-5, 0.0289362, 8.14621e-5, 2.44595e-5, 0.70729, 0.000131428, 7.78495, 1.88809, 2.99927, 0.177006, 0.254106, 0.173401, 1.66882, 2.99713, 1.17434e-5, 7.03714e-6, 6.09986e-6, 0.0504083, 6.46098e-5, 9.38154e-5, 4.13404, 6.6356, 0.188563, 0.0646219, 2.99742, 0.482296, 0.286644, 0.0666906, 2.57614e-6, 2.99968e-6, 0.858529, 1.39496e-5, 4.66364e-6, 0.0409683, 26.1721, 1.12445, 1.88882, 0.0624009, 2.0323, 0.313346, 2.70712, 2.99926, 0.0586253, 0.000730662, 0.0784669, 4.3896e-5, 0.000300769, 0.06418, 0.319625, 0.431269, 0.386734, 0.618726, 0.630307, 1.01177]

import Pkg; Pkg.instantiate()
Pkg.activate(".")
using DrugResponseModel

concs, _, g1s1, g2s1 = load(189, 1);
concs, _, g1s2, g2s2 = load(189, 2);
concs, _, g1s3, g2s3 = load(189, 3);

function figureS1(g1m, g2m, concs, ps)

    efcs = getODEparams(ps, concs)

    # ******* model simulations ********
    G1 = zeros(189, 8, 5)
    G2 = zeros(189, 8, 5)

    t = LinRange(0.0, 95.0, 189)
    for k = 1:5 # drug number
        for i = 1:8 # concentration number
            G1[:, i, k], G2[:, i, k], _ = predict(efcs[:, i, k], efcs[:, 1, k], t)
        end
    end

    p1 = DrugResponseModel.plot_fig1(concs[:, 1], G1[:, :, 1], g1m[:, :, 1], "Dynamical Model Fits - Lapatinib", "G1", "A")
    p2 = DrugResponseModel.plot_fig1(concs[:, 1], G2[:, :, 1], g2m[:, :, 1], "Dynamical Model Fits - Lapatinib", "S/G2", "B")
    p3 = DrugResponseModel.plot_fig1(concs[:, 2], G1[:, :, 2], g1m[:, :, 2], "Dynamical Model Fits - Doxorubicin", "G1", "C")
    p4 = DrugResponseModel.plot_fig1(concs[:, 2], G2[:, :, 2], g2m[:, :, 2], "Dynamical Model Fits - Doxorubicin", "S/G2", "D")
    p5 = DrugResponseModel.plot_fig1(concs[:, 3], G1[:, :, 3], g1m[:, :, 3], "Dynamical Model Fits - Gemcitabine", "G1", "E")
    p6 = DrugResponseModel.plot_fig1(concs[:, 3], G2[:, :, 3], g2m[:, :, 3], "Dynamical Model Fits - Gemcitabine", "S/G2", "F")
    p7 = DrugResponseModel.plot_fig1(concs[:, 4], G1[:, :, 4], g1m[:, :, 4], "Dynamical Model Fits - Paclitaxel", "G1", "G")
    p8 = DrugResponseModel.plot_fig1(concs[:, 4], G2[:, :, 4], g2m[:, :, 4], "Dynamical Model Fits - Paclitaxel", "S/G2", "H")
    p9 = DrugResponseModel.plot_fig1(concs[:, 5], G1[:, :, 5], g1m[:, :, 5], "Dynamical Model Fits - Palbociclib", "G1", "I")
    p10 = DrugResponseModel.plot_fig1(concs[:,5], G2[:, :, 5], g2m[:, :, 5], "Dynamical Model Fits - Palbociclib", "S/G2", "J")
    figureS1 = plot(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, size = (2400, 1050), layout = (2, 5))
    savefig(figureS1, "figureS01.svg")
end
