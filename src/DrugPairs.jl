""" This file handles functions for pairs of drugs. """

function residHillpairs(hP, concentrations::Matrix, g1::Array, g2::Array, v::Int, u::Int)
    res = 0.0

    # Solve for pairs drugs
    t = 1
    k = v # drug1 index
    for j = 1:2
        hill = hP[[t, t + 1, t + 2, t + 3, t + 4, t + 5, t + 6, t + 7, t + 8, t + 9, t + 10, t + 11, t + 12, t + 13, 29, 30, 31, 32, 33, 34]]
        res += residHill(hill, concentrations[:, k], g1[:, :, k], g2[:, :, k])
        t += 14
        k = u # drug 2 index
    end

    return res
end


""" Function to optimize pairs of drugs. """
function BBoptim_DrugPairs(concs::Array{Float64, 2}, g1::Array{Float64, 3}, g2::Array{Float64, 3}, i::Int, j::Int; maxiter = 200000)
    hillCostPairs(hillParams) = residHillpairs(hillParams, concs, g1, g2, i, j)

    low_piece = [1.0, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9]
    high_piece = [500.0, 10.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0]

    low = vcat(low_piece, low_piece, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9, 1e-9) # 34 params: 2 parts G1, 4 parst G2.
    high = vcat(high_piece, high_piece, 2.0, 2.0, 2.0, 2.0, 2.0, 2.0)

    return optimize_helper(hillCostPairs, low, high, maxiter)
end


""" This function takes in the joint estimated parameters and returns both, individually, in one matrix. """
function estimated_params(concs, key)
    # 1. lpt and dox:
    p1 = [
        54.6663,
        1.26066,
        0.0386151,
        0.019592,
        0.000873693,
        0.46178,
        0.389659,
        1.12105,
        0.0115782,
        4.93772e-5,
        0.00532097,
        0.0223183,
        0.000132739,
        0.00956209,
        41.4138,
        1.42081,
        1.77842,
        0.000140926,
        1.97929,
        0.122634,
        0.755111,
        1.99959,
        0.000119775,
        0.0195171,
        1.70441e-5,
        8.52576e-6,
        0.000250443,
        0.358707,
        0.432421,
        0.311679,
        1.68836,
        0.289613,
        1.7641,
        0.473097,
    ]
    # 2. lpt and gem:
    p2 = [
        39.4625,
        1.1858,
        0.0701889,
        0.0438967,
        0.389305,
        1.99817,
        0.350299,
        1.51137,
        0.0157781,
        0.00213176,
        5.3996e-6,
        4.35024e-6,
        1.31877e-5,
        0.0171005,
        6.44004,
        1.96937,
        1.7582,
        0.230694,
        0.280317,
        0.325892,
        0.253752,
        1.99997,
        1.3078e-6,
        1.10453e-7,
        8.05675e-7,
        0.109107,
        2.63982e-6,
        1.48412e-5,
        0.334753,
        0.415623,
        0.770869,
        1.99955,
        0.303631,
        0.694933,
    ]
    # 3. lpt and tax:
    p3 = [
        28.8734,
        1.17466,
        0.54481,
        0.0290452,
        0.472784,
        0.42197,
        0.62102,
        0.839471,
        0.00576387,
        0.00723518,
        2.13114e-5,
        3.09561e-5,
        0.0339602,
        0.000277087,
        4.47769,
        2.54758,
        0.378628,
        0.0605407,
        1.56098,
        1.63461,
        0.225874,
        0.0528277,
        2.71163e-5,
        1.66271e-5,
        0.54058,
        7.52719e-7,
        5.24608e-5,
        0.0393574,
        0.452571,
        0.306451,
        1.36552,
        0.311679,
        1.99973,
        0.479658,
    ]
    # 4. lpt and palbo:
    p4 = [
        49.7244,
        1.1873,
        0.0233371,
        0.0204606,
        0.000197053,
        0.532589,
        0.443461,
        0.85816,
        0.0103168,
        1.74154e-5,
        0.0122738,
        0.0088042,
        0.000118709,
        0.0261182,
        25.3068,
        1.11835,
        1.99534,
        0.0720598,
        1.45493,
        0.470104,
        0.618378,
        1.99663,
        0.12171,
        9.16582e-5,
        0.0456697,
        2.15101e-6,
        1.80822e-5,
        0.0212994,
        0.677465,
        0.252498,
        1.47964,
        0.339392,
        1.70639,
        0.414187,
    ]
    # 5. dox and gem:
    p5 = [
        79.143,
        1.01551,
        1.99979,
        0.0332136,
        1.06879,
        1.13591,
        1.10858,
        1.9998,
        1.22887e-5,
        0.0355376,
        4.40962e-6,
        6.78003e-6,
        1.41475e-6,
        0.380631,
        6.17722,
        1.98484,
        1.12565,
        0.221321,
        0.250757,
        1.9985,
        0.340638,
        0.447169,
        2.94415e-8,
        3.71552e-7,
        1.24485e-6,
        1.26101e-5,
        0.106181,
        2.85258e-6,
        0.278666,
        0.547655,
        0.437289,
        1.99591,
        1.99991,
        0.311957,
    ]
    # 6. dox and tax:
    p6 = [
        38.4892,
        1.35139,
        1.51554,
        3.21029e-6,
        1.54498,
        0.157161,
        0.303982,
        1.99991,
        1.17189e-5,
        0.0204469,
        6.42609e-5,
        1.70916e-5,
        2.82956e-5,
        0.340823,
        2.84407,
        2.89634,
        0.0883533,
        0.154121,
        1.97782,
        0.940473,
        0.300368,
        0.937555,
        0.0656419,
        6.13302e-5,
        0.0354945,
        0.000105729,
        1.06626e-5,
        3.7568e-5,
        0.404354,
        0.331842,
        1.25335,
        0.401365,
        0.78625,
        0.510259,
    ]
    # 7. dox and palbo:
    p7 = [
        52.5206,
        1.17842,
        1.99983,
        0.0983941,
        0.0373522,
        0.194407,
        0.589333,
        1.99965,
        2.73158e-5,
        9.41369e-6,
        0.187334,
        1.58549e-6,
        2.11775e-5,
        0.331326,
        16.3041,
        1.08809,
        1.99891,
        0.074877,
        1.99517,
        0.430633,
        0.602069,
        1.9997,
        0.0857386,
        2.51648e-5,
        0.0277931,
        0.00357802,
        0.017433,
        0.00562056,
        0.519863,
        0.283737,
        1.99987,
        0.306348,
        1.36043,
        0.480509,
    ]
    # 8. gem and tax:
    p8 = [
        7.16739,
        1.98737,
        1.99899,
        0.181038,
        0.182819,
        0.472226,
        0.978985,
        1.99706,
        2.01756e-5,
        7.0822e-7,
        6.88327e-7,
        0.143016,
        3.60068e-5,
        2.7017e-5,
        4.01319,
        3.16131,
        0.131711,
        0.063915,
        1.90299,
        1.9981,
        0.16474,
        0.223082,
        4.44934e-7,
        0.0119837,
        0.189428,
        3.97491e-5,
        2.87363e-6,
        0.110616,
        0.338662,
        0.415369,
        0.296252,
        1.99929,
        0.645497,
        0.965667,
    ]
    # 9. gem and palbo:
    p9 = [
        6.15483,
        1.9652,
        0.88169,
        0.26036,
        0.319946,
        0.280528,
        0.205429,
        1.07089,
        2.98743e-7,
        4.12098e-8,
        1.16296e-8,
        0.0969344,
        3.12294e-7,
        1.95212e-6,
        29.1235,
        1.11835,
        0.0955287,
        0.415902,
        1.4707,
        1.99933,
        0.377391,
        1.99999,
        2.21521e-7,
        1.77619e-6,
        1.53607e-9,
        0.0137909,
        0.0222303,
        0.0799368,
        0.274231,
        0.630045,
        1.056,
        1.99997,
        0.326369,
        0.51053,
    ]
    # 10. tax and palbo:
    dictionary = Dict("1,2" => p1, "1,3" => p2, "1,4" => p3, "1,5" => p4, "2,3" => p5, "2,4" => p6, "2,5" => p7, "3,4" => p8, "3,5" => p9)
    return DrugResponseModel.getODEparams(dictionary[key], concs)

end
